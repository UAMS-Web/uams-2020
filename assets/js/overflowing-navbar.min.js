 /*
  * Bootstrap Responsive Collapse
  * Based on: https://github.com/psyon/bootstrap.responsive-collapse
  */
(function ($) {
	$.fn.responsiveCollapse = function(options) {
		var settings = $.extend({
			breakPoint:       768,
			overflowItemText: 'More'
		}, options);

		var lastDocWidth = $(document).width();

		return this.filter('ul').each(function() {
			var $list        = $(this);
			var container    = $list.parent().parent();
			var overflowItem = $('<li class="dropdown nav-item more-menu d-none"><a href="#" class="dropdown-toggle nav-link" data-toggle="dropdown">' + settings.overflowItemText + '</a><ul class="dropdown-menu dropdown-menu-right"></ul></li>').appendTo($list);
			var overflowList = $(overflowItem).find('ul.dropdown-menu');

			var thisWidth    = $list.outerWidth();
			var maxWidth     = $(container).width() - ($(container).find('.navbar-header').width() || 0);
			
			function reset() {
				var child = $(overflowList).children();
				var count = child.length;
				if (count > 0) {
					for (var i = 0; i < count; i++) {
						$(child[i]).insertBefore($list.children(':last-child'));
					}
				}
				$(overflowItem).addClass('d-none');
			}

			function grow() {
				var overflowWidth = $(overflowItem).width();
				var child         = $(overflowList).children();
				var count         = child.length;

				if (count > 0) {
					for (var i = 0; i < count; i++) {
						// move the first dropdown item to end of list
						$(child[i]).insertBefore($list.children(':last-child'));
						thisWidth = $list.outerWidth();
						if((i == count - 1 && thisWidth - overflowWidth > maxWidth) || (i != count - 1 && thisWidth > maxWidth)) {
							$(child[i]).prependTo(overflowList);
							break;
						}
					}
				}

				// Hide the overflow item if it has no children
				if($(overflowList).children().length == 0) {
					$(overflowItem).addClass('d-none');
				}

				return;
			}

			function shrink() {
				var child = $list.children(':not(:last-child)'); // Get the children of the list, except the last child
				var count = child.length; // the number of children of the list, except the last child
				if (count < 1) return; // if there are 0 children that aren't the last child, return

				// show the overflow link in case it's been hidden
				$(overflowItem).removeClass('d-none');

				for (var i = count - 1; i >= 0; i--) {
					// Statement 1 sets a variable before the loop starts (var i = count - 1).
					// Statement 2 defines the condition for the loop to run (i must be greater than or equal to 0).
					// Statement 3 decreases a value (i--) each time the code block in the loop has been executed.

					// move the last item to dropdown
					$(child[i]).prependTo(overflowList); // move the last item in the child array (the next to last child of the list) to the beginning of the overflow list.

					// recalc width
					thisWidth = $list.outerWidth(); // redefine the list's outer width.
					if(thisWidth < maxWidth) break; // if the new outer width of the list is less than the container width, break.
				}
			}



			function shrink2() {
				var child = $list.children(':not(:last-child)'); // Get the children of the list, except the last child
				var count = child.length; // the number of children of the list, except the last child
				if (count < 1) return; // if there are 0 children that aren't the last child, return

				// show the overflow link in case it's been hidden
				$(overflowItem).removeClass('d-none');

				var i = count - 1;

				$(child[i]).prependTo(overflowList); // move the last item in the child array (the next to last child of the list) to the beginning of the overflow list.

				// recalc width
				thisWidth = $list.outerWidth(); // redefine the list's outer width.
			}

			function refresh() {
				thisWidth = $list.outerWidth();
				maxWidth  = $(container).width() - ($(container).find('.navbar-header').width() || 0);
				var docWidth  = $(document).width();

				if ($(window).width() < settings.breakPoint) { // if unitless width of window is less than 768
					reset();
				} else if (thisWidth > maxWidth) { // if width of list is greater than unitless width of list's grandparent
					shrink2();
				} else if (0 < (docWidth - lastDocWidth)) { // if current document width minus previous document width is greater than 0
					grow();
				}
				lastDocWidth = docWidth;
			}

			$(window).resize(function() {
				refresh();
			}).trigger('resize');
		});
	}
}(jQuery));

$(function() {
    $(".navbar-nav").responsiveCollapse();
});
